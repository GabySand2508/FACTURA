<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Descargar fecha</title>
</head>
<body>
  <p>Generando archivo de fecha...</p>

  <script>
    window.onload = function () {
      try {
        // Obtener parámetros desde la URL
        const params = new URLSearchParams(window.location.search);
        const refno = params.get('refno') || 'No especificado';
        const fecha = params.get('fecha') || 'No especificada';

        // Mostrar los datos en pantalla
        document.body.innerHTML = `
          <p><strong>Ref No:</strong> ${refno}</p>
          <p><strong>Fecha:</strong> ${fecha}</p>
          <p>Generando archivo...</p>
        `;

        // Crear contenido del archivo
        const contenido = `Referencia: ${refno}\nFecha: ${fecha}`;

        // Crear archivo
        const blob = new Blob([contenido], { type: "text/plain" });
        const url = URL.createObjectURL(blob);

        // Crear enlace invisible para descarga
        const link = document.createElement("a");
        link.href = url;
        link.download = `factura_${refno}.txt`;
        link.style.display = "none";
        document.body.appendChild(link);

        // Forzar descarga
        link.click();

        // Limpiar
        document.body.removeChild(link);
        URL.revokeObjectURL(url);

        // Confirmación
        document.body.innerHTML += "<p>✅ Archivo descargado correctamente.</p>";

      } catch (error) {
        console.error(error);
        document.body.innerHTML = "<p>❌ Error al generar la descarga.</p>";
      }
    }
  </script>
</body>
</html>
